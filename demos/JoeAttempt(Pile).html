<!DOCTYPE html>
<html>
<head>
    <title>cannon.js - pile demo</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="css/style.css" type="text/css"/>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>
<body>
    <script src="../build/cannon.js"></script>
    <script src="../build/cannon.demo.js"></script>
    <script src="../libs/dat.gui.js"></script>
    <script src="../libs/Three.js"></script>
    <script src="../libs/TrackballControls.js"></script>
    <script src="../libs/Detector.js"></script>
    <script src="../libs/Stats.js"></script>
    <script src="../libs/smoothie.js"></script>
    <script>

    var demo = new CANNON.Demo();
    var size = 1;
    var interval;

    // Spheres
    demo.addScene("Pile",function(){
        if(interval) clearInterval(interval);

        var world = demo.getWorld();

        world.gravity.set(0,0,-50);
        world.broadphase = new CANNON.NaiveBroadphase();
        world.solver.iterations = 5;

        world.defaultContactMaterial.contactEquationStiffness = 5e6;
        world.defaultContactMaterial.contactEquationRelaxation = 10;

        // Since we have many bodies and they don't move very much, we can use the less accurate quaternion normalization
        world.quatNormalizeFast = false;
        world.quatNormalizeSkip = 3; // ...and we do not have to normalize every step.

        // ground plane
        var groundShape = new CANNON.Plane(new CANNON.Vec3(0,0,1));
        var groundBody = new CANNON.Body({ mass: 0 });
        groundBody.addShape(groundShape);
        groundBody.position.set(0,0,0);
        world.addBody(groundBody);
        demo.addVisual(groundBody);

        var mass = 1;
        // Cylinder shape
        var cylinderShape = new CANNON.Cylinder(size/2, size, 3 * size, 100);
        var cylinderBody = new CANNON.Body({ mass: mass });
        cylinderBody.addShape(cylinderShape);
        cylinderBody.position.set(-size * 2, size * 2, size + 1);
        world.addBody(cylinderBody);
        demo.addVisual(cylinderBody);



        var cylinderShape2 = new CANNON.Cylinder(size / 2, size, 3 * size, 100);
        var cylinderBody2 = new CANNON.Body({ mass: mass });
        cylinderBody2.addShape(cylinderShape);
        cylinderBody2.position.set(-size * 5, size * 5, size + 4);
        world.addBody(cylinderBody2);
        demo.addVisual(cylinderBody2);


        var f = 1000;
        var dt = 1 / 30, damping = 0.01;

        // Add impulse to the body center

        var shape = new CANNON.Sphere(size);
        var body = new CANNON.Body({
            mass: mass,
            position: new CANNON.Vec3(0, 0, 1.)
        });
        body.addShape(shape);
        body.linearDamping = body.angularDamping = damping;


        world.addBody(body);
        demo.addVisual(body);

        // Add an impulse to the center
        var worldPoint = new CANNON.Vec3(0, 0, size);
        var impulse = new CANNON.Vec3(0, -f * dt, 0);
        body.applyImpulse(impulse, worldPoint);
            
    });
    demo.start();

    </script>
</body>
</html>
